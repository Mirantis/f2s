id: ironic
resources:
- id: role_data#{index}#
  from: fuel_resources/role_data
  location: '#{node}#'
  values:
    env: '#{env}#'
    puppet_modules: /etc/puppet/modules
    uid: '#{index}#'
    puppet_modules: '/etc/puppet/modules'
- id: fuel_pkgs#{index}#
  from: fuel_resources/fuel_pkgs
  location: '#{node}#'
  values_from: role_data#{index}#
- id: logging#{index}#
  from: fuel_resources/logging
  location: '#{node}#'
  values_from: role_data#{index}#
- id: tools#{index}#
  from: fuel_resources/tools
  location: '#{node}#'
  values_from: role_data#{index}#
- id: netconfig#{index}#
  from: fuel_resources/netconfig
  location: '#{node}#'
  values_from: role_data#{index}#
- id: connectivity_tests#{index}#
  from: fuel_resources/connectivity_tests
  location: '#{node}#'
  values_from: role_data#{index}#
- id: firewall#{index}#
  from: fuel_resources/firewall
  location: '#{node}#'
  values_from: role_data#{index}#
- id: hosts#{index}#
  from: fuel_resources/hosts
  location: '#{node}#'
  values_from: role_data#{index}#
- id: ironic-conductor#{index}#
  from: fuel_resources/ironic-conductor
  location: '#{node}#'
  values_from: role_data#{index}#
- id: ironic-compute#{index}#
  from: fuel_resources/ironic-compute
  location: '#{node}#'
  values_from: role_data#{index}#
- id: openstack-network-start#{index}#
  from: fuel_resources/openstack-network-start
  location: '#{node}#'
  values_from: role_data#{index}#
- id: openstack-network-common-config#{index}#
  from: fuel_resources/openstack-network-common-config
  location: '#{node}#'
  values_from: role_data#{index}#
- id: openstack-network-plugins-l2#{index}#
  from: fuel_resources/openstack-network-plugins-l2
  location: '#{node}#'
  values_from: role_data#{index}#
- id: openstack-network-end#{index}#
  from: fuel_resources/openstack-network-end
  location: '#{node}#'
  values_from: role_data#{index}#
events:
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: fuel_pkgs#{index}#.run
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: logging#{index}#.run
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: tools#{index}#.run
- type: depends_on
  state: success
  parent_action: logging#{index}#.run
  child_action: tools#{index}#.run
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: netconfig#{index}#.run
- type: depends_on
  state: success
  parent_action: tools#{index}#.run
  child_action: netconfig#{index}#.run
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: connectivity_tests#{index}#.run
- type: depends_on
  state: success
  parent_action: netconfig#{index}#.run
  child_action: connectivity_tests#{index}#.run
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: firewall#{index}#.run
- type: depends_on
  state: success
  parent_action: netconfig#{index}#.run
  child_action: firewall#{index}#.run
- type: depends_on
  state: success
  parent_action: connectivity_tests#{index}#.run
  child_action: firewall#{index}#.run
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: hosts#{index}#.run
- type: depends_on
  state: success
  parent_action: netconfig#{index}#.run
  child_action: hosts#{index}#.run
- type: depends_on
  state: success
  parent_action: connectivity_tests#{index}#.run
  child_action: hosts#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=ssl-add-trust-chain
  child_action: hosts#{index}#.run
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: ironic-conductor#{index}#.run
- type: depends_on
  state: success
  parent_action: firewall#{index}#.run
  child_action: ironic-conductor#{index}#.run
- type: depends_on
  state: success
  parent_action: hosts#{index}#.run
  child_action: ironic-conductor#{index}#.run
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: ironic-compute#{index}#.run
- type: depends_on
  state: success
  parent_action: firewall#{index}#.run
  child_action: ironic-compute#{index}#.run
- type: depends_on
  state: success
  parent_action: hosts#{index}#.run
  child_action: ironic-compute#{index}#.run
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: openstack-network-start#{index}#.run
- type: depends_on
  state: success
  parent_action: ironic-compute#{index}#.run
  child_action: openstack-network-start#{index}#.run
- type: depends_on
  state: success
  parent_action: netconfig#{index}#.run
  child_action: openstack-network-start#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=neutron-keystone
  child_action: openstack-network-start#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=neutron-db
  child_action: openstack-network-start#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=top-role-compute
  child_action: openstack-network-start#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=openstack-controller
  child_action: openstack-network-start#{index}#.run
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: openstack-network-common-config#{index}#.run
- type: depends_on
  state: success
  parent_action: openstack-network-start#{index}#.run
  child_action: openstack-network-common-config#{index}#.run
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: openstack-network-plugins-l2#{index}#.run
- type: depends_on
  state: success
  parent_action: openstack-network-common-config#{index}#.run
  child_action: openstack-network-plugins-l2#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=openstack-network-server-config
  child_action: openstack-network-plugins-l2#{index}#.run
- type: depends_on
  state: success
  parent_action: role_data#{index}#.run
  child_action: openstack-network-end#{index}#.run
- type: depends_on
  state: success
  parent_action: openstack-network-plugins-l2#{index}#.run
  child_action: openstack-network-end#{index}#.run
- type: depends_on
  state: success
  parent_action: openstack-network-common-config#{index}#.run
  child_action: openstack-network-end#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=neutron-keystone
  child_action: openstack-network-end#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=openstack-network-compute-nova
  child_action: openstack-network-end#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=openstack-network-server-config
  child_action: openstack-network-end#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=neutron-db
  child_action: openstack-network-end#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=openstack-network-networks
  child_action: openstack-network-end#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=openstack-network-routers
  child_action: openstack-network-end#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=openstack-network-server-nova
  child_action: openstack-network-end#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=openstack-network-agents-l3
  child_action: openstack-network-end#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=openstack-network-agents-metadata
  child_action: openstack-network-end#{index}#.run
- type: depends_on
  state: success
  parent:
    action: run
    with_tags:
    - resource=openstack-network-agents-dhcp
  child_action: openstack-network-end#{index}#.run
